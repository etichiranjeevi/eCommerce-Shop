pipeline {
  agent any
  stages {
    stage('Clone') {
      steps {
        git branch: 'main', url: 'https://github.com/etichiranjeevi/eCommerce-Shop.git'
      }
    }
    stage('Install') {
      steps {
        sh 'npm install'
      }
    }
    stage('Deploy') {
      steps {
        sh 'scp -o StrictHostKeyChecking=no -r * ubuntu@34.229.91.138:/home/ubuntu/e-commerce/'
        sh ''' ssh ubuntu@34.229.91.138 "cd /home/ubuntu/e-commerce && npm install && pm2 stop e-commerce || true && pm2 start server.js --name e-commerce"'''
      }
    }
  }
}
